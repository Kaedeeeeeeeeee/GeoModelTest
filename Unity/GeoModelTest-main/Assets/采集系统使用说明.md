# 采集道具系统使用说明

## 功能概述
这是一个仿APEX英雄的道具选择UI系统，结合了地质钻探采集功能。玩家可以通过直观的圆盘UI选择不同的采集工具，并在地形上进行真实的地层采样。

## 使用步骤

### 1. 打开配置工具
在Unity编辑器中，点击菜单栏 `Tools → Collection System Setup` 打开配置窗口。

### 2. 一键配置采集系统
点击"配置采集系统"按钮，工具将自动完成以下配置：

#### UI系统配置：
- 创建圆盘式道具选择UI（8个插槽）
- 配置UI输入控制系统
- 设置半透明圆盘背景和工具图标

#### 工具系统配置：
- 为Lily角色添加工具管理器
- 创建钻探工具和3D模型
- 配置工具装备和切换逻辑

#### 地层系统配置：
- 为Terrier地形添加挖掘系统
- 配置圆柱形洞穴创建功能
- 设置地层样本生成系统

## 控制方式

### 道具选择：
- **长按Tab键** - 打开道具选择圆盘
- **鼠标移动** - 在圆盘中选择工具（此时不控制视角）
- **松开Tab键** - 确认选择并关闭圆盘

### 钻探操作：
- **鼠标左键** - 使用当前装备的工具
- **瞄准地面** - 钻探工具会显示钻探位置预览
- **等待钻探** - 钻探过程有视觉效果和音效

### 调试和测试：
- **T键** - 运行系统测试，检查所有组件状态
- **R键** - 手动刷新工具列表（Mac用户友好）

## 钻探工具详解

### 功能特性：
- **精确钻探** - 在瞄准位置创建圆柱形洞穴
- **地层采样** - 自动生成对应地形材质的地层样本
- **视觉反馈** - 钻探过程有粒子效果和进度指示
- **物理仿真** - 样本会根据重力掉落到地面

### 技术参数：
- **钻探半径** - 0.5米（可调节）
- **钻探深度** - 2米（可调节）
- **使用距离** - 5米
- **冷却时间** - 1秒

### 工具模型：
- **手柄** - 棕色圆柱形握把
- **钻头** - 金属灰色钻探部分
- **自动隐藏** - 未装备时不显示

## 地层挖掘系统

### 洞穴特性：
- **圆柱形状** - 精确的圆柱形洞穴
- **动态创建** - 实时在地形上创建洞穴
- **视觉表现** - 黑色深洞效果
- **碰撞检测** - 洞穴具有触发器碰撞体

### 样本生成：
- **材质匹配** - 样本材质与原地形一致
- **形状准确** - 圆柱形样本与钻探参数匹配
- **物理属性** - 样本具有重力和碰撞检测
- **信息显示** - 显示样本类型和来源位置

## 系统扩展

### 添加新工具：
1. 创建继承自`CollectionTool`的新脚本
2. 实现`UseTool(RaycastHit hit)`方法
3. 在工具管理器中注册新工具
4. 为新工具创建图标和模型

### 自定义UI：
- 修改`InventoryUISystem`脚本调整圆盘样式
- 更改`selectionRadius`参数调整选择灵敏度
- 自定义颜色和UI元素外观

### 地形兼容性：
- 系统支持任何带有MeshCollider的地形
- 可以通过LayerMask限制可钻探的地形类型
- 支持复杂地形的多层次钻探

## 故障排除

### 常见问题：

1. **圆盘UI不显示**
   - 确保Canvas组件正确配置
   - 检查UI对象是否被正确创建
   - 验证Input System包已安装

2. **工具无法使用**
   - 确认工具已正确装备（检查工具模型是否显示）
   - 检查瞄准的对象是否在Ground图层
   - 验证使用距离是否足够

3. **钻探无效果**
   - 确保目标对象有MeshCollider组件
   - 检查TerrainHoleSystem是否正确添加
   - 验证地形是否在正确的Layer上

4. **样本不生成**
   - 检查GeologicalSample脚本是否正确配置
   - 确认地形有有效的材质
   - 验证物理系统工作正常

5. **"Concave Mesh Colliders"错误**
   - 已修复：地层样本现在使用CapsuleCollider代替MeshCollider
   - 地层样本使用专门的SamplePhysicsManager管理物理属性
   - 如果仍有问题，检查是否有多个碰撞器冲突

### 性能优化：
- 限制同时存在的洞穴数量
- 使用对象池管理地层样本
- 定期清理不需要的洞穴和样本

## 文件说明

### 核心脚本：
- `InventoryUISystem.cs` - 道具选择UI圆盘系统
- `CollectionTool.cs` - 采集工具基类
- `ToolManager.cs` - 工具管理和切换系统
- `BoringTool.cs` - 钻探工具实现
- `TerrainHoleSystem.cs` - 地层挖掘系统
- `GeologicalSample.cs` - 地层样本管理

### 编辑器工具：
- `CollectionSystemSetupTool.cs` - 一键配置编辑器工具

## 版本要求

- Unity 2021.3 或更高版本
- Input System 包
- TextMeshPro 包（推荐，用于更好的UI文本显示）

## 扩展建议

### 未来功能：
1. **多种工具** - 添加更多采集工具（铲子、筛网等）
2. **样本分析** - 实现样本的详细分析系统
3. **库存管理** - 添加样本存储和管理功能
4. **数据记录** - 记录采集位置和样本数据
5. **成就系统** - 基于采集活动的成就系统