# 钻塔工具设置指南

## 🚀 快速设置步骤

### 1. 添加GameInitializer到场景
```
1. 在场景中创建空GameObject，命名为"GameInitializer"
2. 添加GameInitializer.cs脚本
3. 在Inspector中设置参数：
   - Initialize Drill Tower: ✓ (勾选)
   - Drill Tower Icon: 拖入钻塔图标（可选）
   - Tower Material: 设置钻塔材质（可选）
   - Active Material: 钻探中的材质（可选）
   - Inactive Material: 闲置状态材质（可选）
```

### 2. 确保必要组件存在
确保场景中有以下组件：
- `ToolManager` (管理工具)
- `InventoryUISystem` (工具UI)
- `GeometricSampleReconstructor` (样本重建，会自动创建)
- 地质地层对象 (`GeologyLayer` 组件)

### 3. 测试钻塔工具

#### 步骤A: 选择工具
1. 运行游戏
2. 按 **Tab** 键打开工具轮盘
3. 移动鼠标选择"钻塔工具"
4. 松开Tab键

#### 步骤B: 放置钻塔
1. 工具选中后会自动进入预览模式
2. 移动鼠标瞄准地面位置
3. 看到半透明的钻塔预览
4. **左键点击**放置钻塔

#### 步骤C: 进行钻探
1. 靠近已放置的钻塔（3米范围内）
2. 看到屏幕底部出现"按 F 键进行第1次钻探(0m-2m)"提示
3. **按F键**开始第一次钻探 (0-2m)
4. 等待钻探动画完成（约2秒）
5. 观察样本出现在钻塔周围
6. 重复按F键进行更深层钻探

## 🔧 参数调整

### 钻塔工具参数
在 `DrillTowerSetup.cs` 中可调整：
```csharp
drillTool.maxDrillDepths = 5;        // 最大钻探次数
drillTool.depthPerDrill = 2f;        // 每次钻探深度
drillTool.interactionRange = 3f;     // 交互范围
drillTool.sampleRingRadius = 2.5f;   // 样本环形半径
drillTool.sampleElevation = 1.2f;    // 样本悬浮高度
```

### 钻塔外观
钻塔由以下部件组成（在`CreateDrillTowerPrefab()`中定义）：
- **塔身**: 主体圆柱体 (0.8f, 1.5f, 0.8f)
- **钻探臂**: 水平臂架 (0.3f, 0.3f, 1.2f)
- **钻头**: 钻探头 (0.2f, 0.3f, 0.2f)
- **底座**: 基础平台 (1.2f, 0.2f, 1.2f)

## 🐛 故障排除

### 问题1: 钻塔工具没有出现在工具轮盘中
**解决方案**:
1. 确保GameInitializer脚本已添加到场景
2. 检查ToolManager是否存在
3. 查看控制台是否有"钻塔工具已添加到工具管理器"的日志

### 问题2: 无法放置钻塔（射线检测不到地面）
**解决方案**:
1. **自动修复**: 启用Debug模式，系统会自动修复地面Layer
2. **手动检查**: 在Inspector中找到DrillTowerDebuggerSimple组件，点击"手动检测地面"
3. **Layer检查**: 确保地面对象在Layer 0 (Default)
4. **手动修复**: 在Inspector中找到GroundLayerFixer组件，点击"修复地面Layer设置"

**调试步骤**:
1. 运行游戏，查看控制台日志
2. 应该看到"地面Layer修复完成"消息
3. 在Inspector中点击"手动检测地面"查看射线检测结果
4. 如果仍有问题，查看具体击中了哪个Layer的对象

### 问题3: 按F键钻塔无反应
**解决方案**:
1. 确保距离钻塔足够近（3米内）
2. 确保看到了"按 F 键进行钻探"的UI提示
3. 检查钻塔是否已完成当前钻探（不在isDrilling状态）
4. 确保未达到最大钻探次数（5次）

### 问题4: 钻塔放置成功但看不见
**解决方案**:
1. **自动修复**: Debug模式会自动修复可见性问题
2. **手动修复**: 在Inspector中找到DrillTowerVisibilityFixer组件，点击"检查并修复所有钻塔可见性"
3. **查看标记**: 成功的钻塔会有黄色发光球标记
4. **检查位置**: 确认钻塔在相机视野范围内

**检查步骤**:
1. 在Scene视图中查看钻塔是否存在
2. 检查钻塔对象的Transform组件（缩放是否正常）
3. 检查Renderer组件是否启用
4. 查看控制台是否有"钻塔完全初始化完成"日志

### 问题5: 样本没有出现
**解决方案**:
1. 检查控制台日志，查看是否有几何样本创建的信息
2. 确保钻探位置有地质地层（GeologyLayer组件）
3. 检查GeometricSampleReconstructor是否正常工作

## 📊 预期控制台输出

成功运行时应该看到以下日志：
```
🚀 游戏初始化开始...
开始创建钻塔工具...
钻塔预制件创建完成
✅ 钻塔工具创建完成！
钻塔工具已添加到工具管理器
钻塔工具初始化完成
✅ 游戏初始化完成！

[放置钻塔时]
钻塔已放置在位置: (x, y, z)
钻塔初始化完成

[钻探时]
开始第 1 次钻探
钻塔钻探参数 - 起点: (x, y, z), 深度: 2.00m, 范围: 0.0m-2.0m
✅ 成功创建深度 0.0m-2.0m 的地质样本
钻探完成！当前已钻探 1/5 次
```

## 🎮 完整测试流程

1. **启动游戏** → 看到初始化日志
2. **按Tab** → 工具轮盘出现，看到钻塔工具
3. **选择钻塔工具** → 进入预览模式，看到半透明钻塔
4. **左键放置** → 钻塔出现在地面
5. **靠近钻塔** → 进入交互范围
6. **左键点击钻塔** → 开始钻探动画
7. **等待完成** → 第一个样本出现在钻塔周围
8. **继续点击** → 进行更深层钻探，最多5次

成功完成后，你应该能看到5个不同深度的地质样本环形排列在钻塔周围！

---
**注意**: 如果遇到任何问题，请检查Unity控制台的详细日志信息，这些日志会帮助诊断具体问题。