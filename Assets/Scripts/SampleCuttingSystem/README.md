# æ ·æœ¬åˆ‡å‰²ç³»ç»Ÿ (Sample Cutting System)

## æ¦‚è¿°

æ ·æœ¬åˆ‡å‰²ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„å°æ¸¸æˆç³»ç»Ÿï¼Œå…è®¸ç©å®¶å°†å¤šå±‚åœ°è´¨æ ·æœ¬åˆ‡å‰²æˆçº¯å‡€çš„å•å±‚æ ·æœ¬ï¼Œä¸ºåç»­çš„çŸ¿ç‰©æå–å’Œå®éªŒæä¾›åŸºç¡€ã€‚ç³»ç»Ÿé‡‡ç”¨ç»å…¸çš„ç§»åŠ¨æ¨ªæ¡æ—¶æœºæŒ‰é”®æ¸¸æˆæœºåˆ¶ï¼Œç±»ä¼¼äºã€Šåˆºå®¢ä¿¡æ¡ï¼šå¤§é©å‘½ã€‹ä¸­çš„å¼€é”ç³»ç»Ÿã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ® æ¸¸æˆæœºåˆ¶
- **ç§»åŠ¨æ¨ªæ¡åˆ‡å‰²**: æ¨ªæ¡åœ¨æ ·æœ¬ä¸Šä¸‹ç§»åŠ¨ï¼Œç©å®¶æŒ‰ç©ºæ ¼é”®åœ¨æ­£ç¡®æ—¶æœºè¿›è¡Œåˆ‡å‰²
- **åœ°å±‚è¾¹ç•Œè¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å¤šå±‚æ ·æœ¬ä¸­çš„åœ°å±‚è¾¹ç•Œå’ŒæˆåŠŸåˆ‡å‰²åŒºåŸŸ
- **éš¾åº¦è‡ªé€‚åº”**: æ ¹æ®åœ°å±‚æ•°é‡è‡ªåŠ¨è°ƒæ•´æˆåŠŸåŒºåŸŸå¤§å°
  - 2å±‚æ ·æœ¬: 40cmæˆåŠŸåŒºåŸŸ
  - 3å±‚æ ·æœ¬: 20cmæˆåŠŸåŒºåŸŸ  
  - 4å±‚+æ ·æœ¬: 10cmæˆåŠŸåŒºåŸŸ

### ğŸ”¬ çœŸå®åœ°è´¨æ•°æ®
- **å›¾é‰´ç³»ç»Ÿé›†æˆ**: è‡ªåŠ¨ä»SendaiMineralDatabase.jsonæŸ¥è¯¢åœ°å±‚å¯¹åº”çš„çŸ¿ç‰©ä¿¡æ¯
- **åœ°å±‚åç§°æ˜ å°„**: æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡åœ°å±‚åç§°çš„æ™ºèƒ½åŒ¹é…
- **çŸ¿ç‰©æˆåˆ†åˆ†æ**: ä¸ºæ¯ä¸ªåˆ‡å‰²åçš„æ ·æœ¬æä¾›è¯¦ç»†çš„çŸ¿ç‰©ç»„æˆä¿¡æ¯

### ğŸ¨ è§†è§‰å’ŒéŸ³æ•ˆ
- **2Då‰–é¢å›¾æ˜¾ç¤º**: ç¨‹åºåŒ–ç”Ÿæˆåœ°è´¨æŸ±çŠ¶å›¾ï¼Œæ¸…æ™°æ˜¾ç¤ºåœ°å±‚ç»“æ„
- **3Dæ ·æœ¬é¢„è§ˆ**: å®æ—¶æ—‹è½¬çš„3Dæ ·æœ¬é¢„è§ˆ
- **æ¿€å…‰åˆ‡å‰²æ•ˆæœ**: å—¡å—¡å£°éŸ³æ•ˆï¼ŒæˆåŠŸ/å¤±è´¥æ—¶çš„ç»¿è‰²/çº¢è‰²é—ªå…‰åé¦ˆ
- **å¤šè¯­è¨€æ”¯æŒ**: å®Œæ•´çš„ä¸­è‹±æ—¥ä¸‰è¯­è¨€ç•Œé¢

### ğŸ­ ç³»ç»Ÿé›†æˆ
- **ä»“åº“ç³»ç»Ÿ**: æ”¯æŒä»ä»“åº“æ‹–æ‹½å¤šå±‚æ ·æœ¬åˆ°åˆ‡å‰²å°
- **è‡ªåŠ¨æ”¶é›†**: åˆ‡å‰²æˆåŠŸåæ ·æœ¬è‡ªåŠ¨è¿›å…¥ç©å®¶èƒŒåŒ…
- **å®éªŒå®¤ç¯å¢ƒ**: ä¸“ä¸ºLaboratory Sceneè®¾è®¡çš„å·¥ä½œå°

## ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

#### 1. SampleCuttingGame.cs
- **åŠŸèƒ½**: åˆ‡å‰²å°æ¸¸æˆçš„æ ¸å¿ƒæ§åˆ¶å™¨
- **èŒè´£**: æ¨ªæ¡ç§»åŠ¨ã€è¾“å…¥æ£€æµ‹ã€æ—¶æœºåˆ¤å®šã€éŸ³æ•ˆæ’­æ”¾
- **å…³é”®æ–¹æ³•**:
  - `StartCutting()`: å¼€å§‹åˆ‡å‰²æŒ‡å®šæ ·æœ¬
  - `PerformCut()`: æ‰§è¡Œåˆ‡å‰²æ“ä½œ
  - `HandleSuccessfulCut()`: å¤„ç†æˆåŠŸåˆ‡å‰²
  - `HandleFailedCut()`: å¤„ç†å¤±è´¥åˆ‡å‰²

#### 2. SampleLayerAnalyzer.cs
- **åŠŸèƒ½**: æ ·æœ¬åœ°å±‚ç»“æ„åˆ†æ
- **èŒè´£**: è¯†åˆ«åœ°å±‚è¾¹ç•Œã€è®¡ç®—æˆåŠŸåŒºåŸŸã€ç”Ÿæˆåˆ‡å‰²æ•°æ®
- **å…³é”®æ–¹æ³•**:
  - `AnalyzeLayerBoundaries()`: åˆ†ææ ·æœ¬è¾¹ç•Œ
  - `CanSampleBeCut()`: éªŒè¯æ ·æœ¬æ˜¯å¦å¯åˆ‡å‰²
  - `GetSampleInfo()`: è·å–æ ·æœ¬è¯¦ç»†ä¿¡æ¯

#### 3. LayerDatabaseMapper.cs
- **åŠŸèƒ½**: åœ°å±‚æ•°æ®åº“æ˜ å°„å™¨
- **èŒè´£**: æŸ¥è¯¢å›¾é‰´æ•°æ®åº“ï¼Œè·å–åœ°å±‚å¯¹åº”çš„çŸ¿ç‰©ä¿¡æ¯
- **å…³é”®æ–¹æ³•**:
  - `GetMineralsForLayer()`: æ ¹æ®åœ°å±‚åç§°è·å–çŸ¿ç‰©ä¿¡æ¯
  - `LoadDatabase()`: åŠ è½½SendaiMineralDatabase.json
  - `FindMatchingLayer()`: æ™ºèƒ½åœ°å±‚åç§°åŒ¹é…

#### 4. CuttingStationUI.cs
- **åŠŸèƒ½**: åˆ‡å‰²å°ç”¨æˆ·ç•Œé¢ç®¡ç†
- **èŒè´£**: 2Då‰–é¢å›¾æ˜¾ç¤ºã€3Dé¢„è§ˆã€UIçŠ¶æ€ç®¡ç†
- **å…³é”®æ–¹æ³•**:
  - `LoadSample()`: åŠ è½½æ ·æœ¬åˆ°UI
  - `GenerateLayerDiagram()`: ç”Ÿæˆåœ°å±‚å›¾
  - `CreateSamplePreview()`: åˆ›å»º3Dé¢„è§ˆ

#### 5. SingleLayerSampleGenerator.cs
- **åŠŸèƒ½**: å•å±‚æ ·æœ¬ç”Ÿæˆå™¨
- **èŒè´£**: åˆ›å»ºåˆ‡å‰²åçš„ç‹¬ç«‹æ ·æœ¬å¯¹è±¡
- **å…³é”®æ–¹æ³•**:
  - `GenerateSamplesFromMultiLayer()`: ä»å¤šå±‚æ ·æœ¬ç”Ÿæˆå•å±‚æ ·æœ¬
  - `CreateSampleGameObject()`: åˆ›å»ºæ ·æœ¬3Då¯¹è±¡
  - `CalculatePhysicalProperties()`: è®¡ç®—ç‰©ç†å±æ€§

#### 6. SampleCuttingSystemManager.cs
- **åŠŸèƒ½**: ç³»ç»Ÿç®¡ç†å™¨
- **èŒè´£**: åè°ƒæ‰€æœ‰ç»„ä»¶ï¼Œæä¾›ç»Ÿä¸€æ¥å£
- **å…³é”®æ–¹æ³•**:
  - `StartCuttingSample()`: ä¸»è¦å…¥å£ç‚¹
  - `HandleCuttingSuccess()`: æˆåŠŸå¤„ç†æµç¨‹
  - `GetStatistics()`: è·å–ç³»ç»Ÿç»Ÿè®¡

#### 7. WarehouseIntegration.cs
- **åŠŸèƒ½**: ä»“åº“ç³»ç»Ÿé›†æˆ
- **èŒè´£**: å¤„ç†æ‹–æ‹½äº¤äº’ï¼ŒéªŒè¯æ ·æœ¬ç±»å‹
- **å…³é”®æ–¹æ³•**:
  - `OnDrop()`: å¤„ç†æ‹–æ‹½æ”¾ç½®
  - `ValidateDraggedObject()`: éªŒè¯æ‹–æ‹½å¯¹è±¡
  - `StartCuttingProcess()`: å¯åŠ¨åˆ‡å‰²æµç¨‹

### æ•°æ®ç»“æ„

#### SingleLayerSample
åˆ‡å‰²åçš„å•å±‚æ ·æœ¬æ•°æ®ï¼š
```csharp
public class SingleLayerSample
{
    public string sampleID;              // æ ·æœ¬å”¯ä¸€ID
    public string layerName;             // åœ°å±‚åç§°
    public GameObject sampleObject;      // 3Dæ˜¾ç¤ºå¯¹è±¡
    public MineralComposition[] minerals; // çŸ¿ç‰©ç»„æˆ
    public bool isCutFromMultiLayer;     // æ˜¯å¦æ¥è‡ªåˆ‡å‰²
    // ... å…¶ä»–å±æ€§
}
```

#### MineralComposition
çŸ¿ç‰©æˆåˆ†æ•°æ®ï¼š
```csharp
public class MineralComposition
{
    public string mineralName;          // çŸ¿ç‰©åç§°
    public float percentage;            // å«é‡ç™¾åˆ†æ¯”
    public string imageFile;            // å›¾ç‰‡æ–‡ä»¶
    public string modelFile;            // 3Dæ¨¡å‹æ–‡ä»¶
    public MineralProperties properties; // è¯¦ç»†å±æ€§
}
```

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€è®¾ç½®

1. **åœ¨Laboratory Sceneä¸­æ·»åŠ åˆ‡å‰²å°**:
```csharp
// è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
var initializer = gameObject.AddComponent<SampleCuttingSystemInitializer>();

// æ‰‹åŠ¨åˆå§‹åŒ–
var manager = gameObject.AddComponent<SampleCuttingSystemManager>();
manager.InitializeSystem();
```

2. **è®¾ç½®æ‹–æ‹½åŒºåŸŸ**:
```csharp
var warehouseIntegration = gameObject.AddComponent<WarehouseIntegration>();
// é…ç½®æ‹–æ‹½æ¥æ”¶åŒºåŸŸ
```

### ä½¿ç”¨æµç¨‹

1. **ç©å®¶æ“ä½œæµç¨‹**:
   - åœ¨ä»“åº“ä¸­é€‰æ‹©å¤šå±‚æ ·æœ¬
   - æ‹–æ‹½æ ·æœ¬åˆ°åˆ‡å‰²å°çš„æ‹–æ‹½åŒºåŸŸ
   - ç³»ç»Ÿè‡ªåŠ¨åˆ†ææ ·æœ¬åœ°å±‚ç»“æ„
   - ç‚¹å‡»"å¼€å§‹åˆ‡å‰²"æŒ‰é’®
   - è§‚å¯Ÿç§»åŠ¨çš„åˆ‡å‰²çº¿ï¼Œåœ¨ç»¿è‰²æˆåŠŸåŒºåŸŸå†…æŒ‰ç©ºæ ¼é”®
   - é‡å¤åˆ‡å‰²ç›´åˆ°æ‰€æœ‰åœ°å±‚åˆ†ç¦»
   - æ”¶é›†ç”Ÿæˆçš„å•å±‚æ ·æœ¬åˆ°èƒŒåŒ…

2. **ç¨‹åºè°ƒç”¨æµç¨‹**:
```csharp
// è·å–ç³»ç»Ÿç®¡ç†å™¨
var manager = FindObjectOfType<SampleCuttingSystemManager>();

// æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
if (manager.GetSystemState().isOccupied)
{
    Debug.Log("åˆ‡å‰²å°å¿™ç¢Œä¸­");
    return;
}

// å¼€å§‹åˆ‡å‰²
bool success = manager.StartCuttingSample(reconstructedSample);

// ç›‘å¬äº‹ä»¶
manager.OnSamplesGenerated += OnSamplesCreated;
manager.OnCuttingCompleted += OnCuttingFinished;
```

### è‡ªå®šä¹‰é…ç½®

#### æˆåŠŸåŒºåŸŸè®¾ç½®
```csharp
var analyzer = GetComponent<SampleLayerAnalyzer>();
// ä¿®æ”¹successZoneSettingsæ•°ç»„æ¥è°ƒæ•´éš¾åº¦
```

#### æ ·æœ¬ç”Ÿæˆé…ç½®
```csharp
var generator = GetComponent<SingleLayerSampleGenerator>();
generator.generationConfig.sampleScale = 1.2f;      // æ ·æœ¬ç¼©æ”¾
generator.generationConfig.enablePhysics = true;     // å¯ç”¨ç‰©ç†
generator.generationConfig.autoCollect = true;       // è‡ªåŠ¨æ”¶é›†
```

## è°ƒè¯•å’Œæµ‹è¯•

### è°ƒè¯•é€‰é¡¹
- å¯ç”¨`enableDebugMode`æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- ä½¿ç”¨Context Menuæµ‹è¯•å„ä¸ªç»„ä»¶
- æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€ï¼š`manager.CheckSystemHealth()`

### å¸¸è§é—®é¢˜

#### 1. æ ·æœ¬æ— æ³•åˆ‡å‰²
- æ£€æŸ¥æ ·æœ¬æ˜¯å¦æœ‰å¤šå±‚ï¼š`analyzer.CanSampleBeCut(sample)`
- éªŒè¯æ ·æœ¬æ•°æ®å®Œæ•´æ€§ï¼š`sample.layerSegments != null`

#### 2. çŸ¿ç‰©ä¿¡æ¯ç¼ºå¤±
- ç¡®ä¿SendaiMineralDatabase.jsonå·²åŠ è½½
- æ£€æŸ¥åœ°å±‚åç§°æ˜ å°„ï¼š`mapper.IsLayerInDatabase(layerName)`

#### 3. UIæ˜¾ç¤ºå¼‚å¸¸
- éªŒè¯UIç»„ä»¶å¼•ç”¨å®Œæ•´
- æ£€æŸ¥Canvasè®¾ç½®

### æ€§èƒ½ä¼˜åŒ–

1. **å¯¹è±¡æ± **: å¯ä»¥ä¸ºç”Ÿæˆçš„æ ·æœ¬å®ç°å¯¹è±¡æ± 
2. **å¼‚æ­¥åŠ è½½**: å¤§å‹æ ·æœ¬çš„åˆ†æå¯ä»¥å¼‚æ­¥è¿›è¡Œ
3. **LODç³»ç»Ÿ**: 3Dé¢„è§ˆå¯ä»¥ä½¿ç”¨ç®€åŒ–æ¨¡å‹

## æ‰©å±•æ€§

### æ–°å¢åˆ‡å‰²å·¥å…·
å¯ä»¥æ‰©å±•æ”¯æŒä¸åŒç±»å‹çš„åˆ‡å‰²å·¥å…·ï¼š
```csharp
public abstract class CuttingTool
{
    public abstract void PerformCut(LayerBoundary boundary);
}
```

### æ–°å¢æ ·æœ¬ç±»å‹
æ”¯æŒæ–°çš„æ ·æœ¬æ ¼å¼ï¼š
```csharp
public interface ISampleCuttable
{
    bool CanBeCut();
    LayerBoundary[] GetLayerBoundaries();
}
```

### æ–°å¢å°æ¸¸æˆæœºåˆ¶
å¯ä»¥æ›¿æ¢ç§»åŠ¨æ¨ªæ¡æœºåˆ¶ï¼š
```csharp
public abstract class CuttingGameMode
{
    public abstract void StartCutting();
    public abstract bool CheckCuttingAccuracy();
}
```

## ç‰ˆæœ¬å†å²

- **v1.0**: åŸºç¡€åˆ‡å‰²ç³»ç»Ÿï¼Œæ”¯æŒç§»åŠ¨æ¨ªæ¡æ¸¸æˆæœºåˆ¶
- **v1.1**: é›†æˆå›¾é‰´æ•°æ®åº“ï¼Œè‡ªåŠ¨çŸ¿ç‰©ä¿¡æ¯æŸ¥è¯¢
- **v1.2**: ä»“åº“ç³»ç»Ÿé›†æˆï¼Œæ‹–æ‹½äº¤äº’
- **v1.3**: å¤šè¯­è¨€æ”¯æŒï¼Œå®Œæ•´UIç³»ç»Ÿ

## è®¸å¯è¯

æ­¤ç³»ç»Ÿä¸ºGeoClone1é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œéµå¾ªé¡¹ç›®æ•´ä½“è®¸å¯è¯ã€‚

---

**å¼€å‘è€…**: Claude Code Assistant  
**æœ€åæ›´æ–°**: 2025-08-18  
**å…¼å®¹ç‰ˆæœ¬**: Unity 2022.3+ LTS